<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Student Look Up</title>
</head>
<body>
<!-- <element onload="myfunction_onload"> -->

<label for="fname">Enter Student First Name:</label>
<input type="text" id="fname" name="fname"><br><br>
<label for="lname">Enter Student Last Name:</label>
<input type="text" id="lname" name="lname"><br><br>
<label for="year">Enter Student's Year:</label>
<input type="number" id="year" value="0"><br><br>
<input type="submit" onclick='getstudentinfo()' id="subbutton" value="Get Student Info">
<input type="submit" onclick='editstudent()' id="editbutton" value="Edit Student">
<input type="submit" onclick='createstudent()' id="createbutton" value="Create New Student">
<label for="test" id="test"></label> <br><br>
<label for="fdback" id="fdback"></label>

<!-- the data in action is the url, values get added on -->
<!-- <form action="" method="get">
    <input type="hidden" name="foo" value="xyz">
    <input type="submit">
  </form>

</body> -->
<p id="deets"></p>
<p id="feedback"></p>
<p id="weekshomeworknotdone"></p>

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.min.js">
</script>

<script>

    // function createstudent(){
    //     var fn = document.getElementById("fname").value
    //     var ln = document.getElementById("lname").value
    //     var year = document.getElementById("year").value
    //     $.post("/createstudent", {fname: fn, lname: ln, yr: year}, success=function(response){
    //         alert(response['fname'] + " " + response['lname'] + " has been created");
    //     });
    // }

    function deletestudent(){
        var fn = document.getElementById("fname").value
        var ln = document.getElementById("lname").value
        var year = document.getElementById("year").value
        $.post("/deletestudent", {fname: fn, lname: ln, yr: year}, success=function(response){
            alert(response['fname'] + " " + response['lname'] + " has been deleted");
        });
    }

    function editstudent(){
        // var url = new URL(window.location.href + "editstudents");
        // window.location.href = url;
        //idea, pass year name and last name to the edit page, those values get filled in the data
        //change student page
        var fn = document.getElementById("fname").value;
        var ln = document.getElementById("lname").value;
        var year = document.getElementById("year").value;
        var url = new URL(window.location.href + "studentpage");
        url.searchParams.append('fn', fn);
        url.searchParams.append('ln', ln);
        url.searchParams.append('yr', year);
        window.location.href = url;
    }

    function getstudentinfo(){
        var fn = document.getElementById("fname").value
        var ln = document.getElementById("lname").value
        var year = document.getElementById("year").value
        //works!
        
        $.post("/studentinfo", {fname: fn, lname: ln, yr: year}, success=function(response){
            feedback = ""
            for (var i = 0; i < response['feedback'].length; i++){
                feedback += response['feedback'][i][1] + " Feedback: " + response['feedback'][i][0] + "<br>";
            }
            //get the last week, then check the homework
            lastweek = response['feedback'][response['feedback'].length - 1][2]


            document.getElementById("feedback").innerHTML = feedback;
            document.getElementById("weekshomeworknotdone").innerHTML = "Weeks of Homework Not Done: " + lastweek;
            document.getElementById("deets").innerHTML = "Phone: " + response['phone'] + "<br>" + "Stars: " + response['stars'];
        });
    }
    function createstudent(){
        var url = new URL(window.location.href + "createnewstudent");
        window.location.href = url;
        //new url needs to be exact otherwise shit breaks, very specific you need to give it raw data
        //https://stackoverflow.com/questions/32153372/java-variable-in-url-not-working

        //the above code just does this, which also works
        //window.location.href = "/studentpage?fn=" + fn + "&ln=" + ln;

        // $.ajax({
        //     url:"",
        //     context: document.body});}

        //$("#test").load("/studentpage", {fname: fn, lname: ln});
        //window.location.href = "/studentpage?fn=" + fn + "&ln=" + ln;
        // $.ajax({
        //     url: "/studentpage",
        //     type: "POST",
        //     data: {fname: fn, lname: ln},
        //     context: document.body,
        //     success: function(response){
                
        //     }
        // });
        // this works
        //windows.alert("hi"); is pog
        // document.querySelector('#test').innerHTML = '{{firstname}}';
    }
//            type: "POST",
//data: {fname: fn, lname: ln},

    function myfunction_clickevent2(){
        $.ajax({
            url:"/test2",
            context: document.body});}
</script>

